name: Enable Auto Merge
description: Enable auto-merge on the generated pull request.
inputs:
  token:
    description: GitHub token used to enable auto-merge.
    required: true
  pull-request-number:
    description: Pull request number.
    required: true
  repository:
    description: owner/repo identifier.
    required: true
  method:
    description: Merge method (merge, squash, rebase).
    required: false
    default: "squash"
  delete-branch:
    description: Delete head branch after merge when true.
    required: false
    default: "true"
runs:
  using: composite
  steps:
    - name: Enable auto-merge
      shell: bash
      env:
        GH_TOKEN: ${{ inputs.token }}
        DELETE_BRANCH: ${{ inputs.delete-branch }}
      run: |
        set -euo pipefail
        if [ -z "${GH_TOKEN}" ]; then
          echo "::warning::No token supplied for auto-merge; skipping."
          exit 0
        fi
        delete_flag=""
        if [ "${DELETE_BRANCH}" = "true" ] || [ "${DELETE_BRANCH}" = "1" ]; then
          delete_flag="--delete-branch"
        fi
        echo "::group::gh pr merge"
        gh pr merge "${{ inputs.pull-request-number }}" \
          --repo "${{ inputs.repository }}" \
          --${{ inputs.method }} \
          --auto ${delete_flag}
        echo "::endgroup::"
